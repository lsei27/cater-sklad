services:
  # API Service (Backend)
  - type: web
    name: cater-sklad-api
    env: docker
    dockerContext: .
    dockerfilePath: Dockerfile
    plan: free
    healthCheckPath: /health
    envVars:
      - key: JWT_SECRET
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: cater-sklad-db
          property: connectionString
      - key: STORAGE_DIR
        value: /var/data
    disk:
      name: storage
      mountPath: /var/data
      sizeGB: 1

  # Web Service (Frontend)
  - type: static
    name: cater-sklad-web
    envVars:
      - key: VITE_API_BASE_URL
        fromService:
          type: web
          name: cater-sklad-api
          property: url
    buildCommand: npm install -g pnpm && pnpm install && pnpm --filter @cater-sklad/shared build && pnpm --filter @cater-sklad/web build
    publishDir: apps/web/dist
    routes:
      - type: rewrite
        source: /**
        destination: /index.html

databases:
  - name: cater-sklad-db
    databaseName: cater_sklad
    user: cater
    plan: free
